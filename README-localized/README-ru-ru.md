---
page_type: sample
products:
- office-excel
- office-onedrive
- ms-graph
languages:
- aspx
- csharp
description: "В этом примере показано, как подключить веб-приложение ASP.NET к рабочей или учебной (Azure Active Directory) учетной записи Майкрософт, используя API Microsoft Graph."
extensions:
  contentType: samples
  technologies:
  - Microsoft Graph
  services:
  - Excel 
  - OneDrive
  - Users
  createdDate: 12/4/2017 10:26:12 AM
---
# Пример использования Microsoft Graph в Excel Starter для ASP.NET 4.6

## Содержание

* [Предварительные требования](#prerequisites)
* [Регистрация приложения](#register-the-application)
* [Сборка и запуск примера](#build-and-run-the-sample)
* [Вопросы и комментарии](#questions-and-comments)
* [Участие](#contributing)
* [Дополнительные ресурсы](#additional-resources)

В этом примере показано, как подключить веб-приложение ASP.NET 4.6 MVC к рабочей или учебной (Azure Active Directory) либо личной учетной записи Майкрософт с помощью API Microsoft Graph для получения сведений профиля пользователя и отправки этих сведений в книгу Excel. Для работы с данными, которые возвращает Microsoft Graph, используется [клиентская библиотека Microsoft Graph .NET](https://github.com/microsoftgraph/msgraph-sdk-dotnet). 

Кроме того, для проверки подлинности в этом примере используется [Библиотека проверки подлинности Майкрософт (Microsoft Authentication Library, MSAL)](https://www.nuget.org/packages/Microsoft.Identity.Client/). В пакете SDK MSAL предусмотрены функции для работы с [конечной точкой Azure AD версии 2.0](https://azure.microsoft.com/en-us/documentation/articles/active-directory-appmodel-v2-overview), которая позволяет разработчикам создать единый поток кода для проверки подлинности как рабочих или учебных (Azure Active Directory), так и личных учетных записей Майкрософт.

## Важное примечание о предварительной версии MSAL

Эту библиотеку можно использовать в рабочей среде. Для этой библиотеки мы предоставляем тот же уровень поддержки, что и для текущих библиотек рабочей среды. Мы можем внести изменения в API, формат внутреннего кэша и другие функциональные элементы, касающиеся этой предварительной версии библиотеки, которые вам потребуется принять вместе с улучшениями или исправлениями. Это может повлиять на ваше приложение. Например, в результате изменения формата кэша пользователям может потребоваться опять выполнить вход. При изменении API может потребоваться обновить код. Когда мы предоставим общедоступный выпуск, вам потребуется выполнить обновление до общедоступной версии в течение шести месяцев, так как приложения, написанные с использованием предварительной версии библиотеки, могут больше не работать.

## Необходимые условия

Для этого примера требуются следующие компоненты:  

  * [Visual Studio](https://www.visualstudio.com/en-us/downloads) 
  * [Учетная запись Майкрософт](https://www.outlook.com) или [учетная запись Office 365 для бизнеса](https://msdn.microsoft.com/en-us/office/office365/howto/setup-development-environment#bk_Office365Account). Вы можете [подписаться на план Office 365 для разработчиков](https://msdn.microsoft.com/en-us/office/office365/howto/setup-development-environment#bk_Office365Account), включающий ресурсы, которые необходимы для создания приложений Office 365.
  * Передайте файл **demo.xlsx** в корне этого репозитория в корневую папку вашей учетной записи OneDrive. Этот файл содержит пустую таблицу с двумя столбцами.
  
## Регистрация приложения

1. Определите URL-адрес приложения ASP.NET. В обозревателе решений Visual Studio выберите проект **Microsoft Graph Excel REST ASPNET**. В окне **Свойства** найдите **URL-адрес**. Скопируйте это значение.

    ![Снимок экрана: окно "Свойства" в Visual Studio](./images/vs-project-url.jpg)

1. Откройте браузер и перейдите к [Центру администрирования Azure Active Directory](https://aad.portal.azure.com). Войдите с помощью **личной учетной записи** (т. е. учетной записи Майкрософт) или **рабочей или учебной учетной записи**.

1. Выберите **Azure Active Directory** на панели навигации слева, затем выберите **Регистрация приложения (предварительная версия)** в разделе **Управление**.

    ![Снимок экрана раздела регистрации приложений](./images/add-portal-app-registrations.jpg)

1. Выберите **Новая регистрация**. На странице **Регистрация приложения** задайте необходимые значения следующим образом:

    - Для параметра **Имя** задайте значение `Пример ASPNET Excel Starter`.
    - Задайте для параметра **Поддерживаемые типы учетных записей** значение **Учетные записи в любом каталоге организации и личные учетные записи Майкрософт**.
    - В разделе **URI-адрес перенаправления** выберите в первом раскрывающемся списке пункт `Веб` и задайте URL-адрес приложения ASP.NET, который вы скопировали на первом шаге.

    ![Снимок экрана страницы регистрации приложения](./images/add-register-an-app.jpg)

1. Нажмите кнопку **Зарегистрировать**. На странице **Пример ASPNET Excel Starter** скопируйте значение **Идентификатор приложения (клиента)** и сохраните его — оно потребуется на следующем шаге.

    ![Снимок экрана с идентификатором приложения для регистрации нового приложения](./images/add-application-id.jpg)

1. Выберите **Проверка подлинности** в разделе **Управление**. Найдите раздел **Неявное представление** и включите **Маркеры идентификации**. Нажмите кнопку **Сохранить**.

    ![Снимок экрана: раздел "Неявное предоставление"](./images/add-implicit-grant.jpg)

1. Выберите **Сертификаты и секреты** в разделе **Управление**. Нажмите кнопку **Новый секрет клиента**. Введите значение в поле **Описание**, выберите один из вариантов для **Срок действия** и нажмите **Добавить**.

    ![Снимок экрана: диалоговое окно "Добавление секрета клиента"](./images/add-new-client-secret.jpg)

1. Скопируйте значение секрета клиента, а затем покиньте эту страницу. Оно вам понадобится на следующем шаге.

    > [ВАЖНО!]
    > Этот секрет клиента больше не будет отображаться, поэтому обязательно скопируйте его.

    ![Снимок экрана: только что добавленный секрет клиента](./images/add-copy-client-secret.jpg)

## Сборка и запуск примера

1. Скачайте или клонируйте пример Microsoft Graph Excel Starter для ASP.NET 4.6.

2. Откройте пример решения в Visual Studio.

3. В корневом каталоге в файле Web.config замените заполнители **ida:AppId** и **ida:AppSecret** идентификатором приложения и паролем, которые вы скопировали при регистрации приложения.

4. Нажмите клавишу F5 для сборки и запуска примера. При этом будут восстановлены зависимости пакета NuGet и откроется приложение.

   >Если при установке пакетов возникают ошибки, убедитесь, что локальный путь к решению не слишком длинный. Чтобы устранить эту проблему, переместите решение ближе к корню диска.

5. Войдите с помощью личной, рабочей или учебной учетной записи и предоставьте необходимые разрешения.

6. Нажмите кнопку **Получить адрес электронной почты**. После завершения операции на странице отобразятся имя и адрес электронной почты пользователя, выполнившего вход.

7. Нажмите кнопку **Отправить в Excel**. Приложение создаст в книге demo.xlsx новую строку и добавит в нее имя пользователя и адрес электронной почты. Под кнопкой появится сообщение об успешной операции.

## Вопросы и комментарии

Мы будем рады узнать ваше мнение об этом примере. Вы можете отправлять нам свои вопросы и предложения на вкладке [Issues](https://github.com/microsoftgraph/aspnet-excelstarter-sample/issues) (Проблемы) этого репозитория.

Ваш отзыв важен для нас. Для связи с нами используйте сайт [Stack Overflow](http://stackoverflow.com/questions/tagged/microsoftgraph). Помечайте свои вопросы тегом [MicrosoftGraph].

## Участие ##

Если вы хотите добавить код в этот пример, просмотрите статью [CONTRIBUTING.md](CONTRIBUTING.md).

Этот проект соответствует [правилам поведения Майкрософт, касающимся обращения с открытым кодом](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [вопросов и ответов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).

## Дополнительные ресурсы

- [Другие примеры Microsoft Graph Connect](https://github.com/MicrosoftGraph?utf8=%E2%9C%93&query=-Connect)
- [Общие сведения о Microsoft Graph](http://graph.microsoft.io)
- [Примеры кода решений для Office](http://dev.office.com/code-samples)
- [Центр разработки для Office](http://dev.office.com/)

## Авторские права
(c) Корпорация Майкрософт (Microsoft Corporation), 2019. Все права защищены.


